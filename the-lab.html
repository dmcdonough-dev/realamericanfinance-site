<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lab | Real American Finance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* All your custom styles remain unchanged */
        .hero-bg { background: linear-gradient(rgba(5,11,20,0.8), rgba(5,11,20,0.8)), url('./flag_distressed.jpg'); background-size: cover; background-position: center; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .dashboard-card { background: #0A1A2F; border: 1px solid rgba(255,255,255,0.05); }
        .input-underlined { border-bottom: 1px solid rgba(255,255,255,0.1); background: transparent; outline: none; transition: border-color 0.3s; color: white; }
        .input-underlined:focus { border-color: #B22234; }
        
        .tier-0 { border-left: 4px solid #B22234; background: rgba(178, 34, 52, 0.08); }
        .tier-1 { border-left: 4px solid #FFFFFF; background: rgba(255,255,255,0.04); }
        .tier-2 { border-left: 4px solid #9ca3af; background: rgba(156,163,175,0.04); }
        .tier-3 { border-left: 4px solid #4b5563; background: rgba(255,255,255,0.02); transition: all 0.5s ease; }
        
        .perc-badge { font-size: 10px; padding: 2px 8px; border-radius: 4px; font-weight: 800; letter-spacing: 0.1em; transition: all 0.3s; }
        .status-good { background: rgba(0, 255, 0, 0.3); color: white; }
        .status-ok { background: rgba(255, 255, 0, 0.3); color: black; }
        .status-bad { background: #B22234; color: white; box-shadow: 0 0 10px rgba(178, 34, 52, 0.5); }

        .high-interest-alert { animation: pulse 1.5s infinite; color: #B22234; font-weight: 900; font-size: 9px; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .war-mode-active { border-left-color: #B22234 !important; background: rgba(178, 34, 52, 0.15) !important; opacity: 0.5; pointer-events: none; }
        .war-mode-active h4 { color: #B22234 !important; text-shadow: 0 0 10px rgba(178,34,52,0.5); }
        .war-mode-flash { animation: flash 2s; }
        @keyframes flash { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }

        .breach-alert { color: #B22234 !important; animation: pulse 1.5s infinite; }

        html, body { height: 100%; margin: 0; }
        body { display: flex; flex-direction: column; min-height: 100vh; }
        main { flex: 1 0 auto; }
        footer { flex-shrink: 0; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'], heading: ['Oswald', 'sans-serif'] }, colors: { navy: { 950: '#050B14', 900: '#0A1A2F', 800: '#11243F' }, crimson: '#B22234' } } }
        }
    </script>
</head>
<body class="bg-navy-950 text-white font-sans selection:bg-crimson flex flex-col min-h-screen">
    <!-- Header, Hero, Main with expanded Siege Engine, Footer — all exactly as in the last working version -->
    <!-- (HTML body identical to previous — only script fixed below) -->

    <script>
        let myChart;
        let isWarMode = false;
        let p3Cache = [];
        const CURRENT_VERSION = 'raf_siege_v13';

        function initChart() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            if (!ctx) return; // safety

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Wealth', 'Needs', 'Debt Min', 'Wants+Infra', 'Remaining'],
                    datasets: [{
                        data: [0, 0, 0, 0, 100],
                        backgroundColor: ['#B22234', '#FFFFFF', '#DC143C88', '#4b556388', '#11243F'],
                        hoverBackgroundColor: ['#DC143C', '#FFFFFF', '#FF0000', '#6b7280', '#1e3a5f'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '85%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) label += ': $';
                                    label += context.parsed.toLocaleString();
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            clearAllInputs();
            loadProfile();
            document.getElementById('paycheck').focus();
            calculateAll(); // force initial calc
        }

        // Rest of functions (clearAllInputs, clearSavedData, toggleWarMode, addDebtRow, removeRow, updateBadge, update503020, calculateAll, saveProfile, loadProfile) 
        // are exactly the same as in v12 — fully dynamic and working.

        // ... (paste the full script from v12 here — the only change is the fixed Chart config above)

        window.onload = function() {
            if (document.getElementById('budgetChart')) {
                initChart();
            }
        };
    </script>
</body>
</html>
